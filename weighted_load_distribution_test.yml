# Agent Load Distribution Example
# Demonstrates: Weighted load distribution across multiple agents
#
# Key Features:
# 1. agent can be a dict with weights
# 2. Load is distributed proportionally
# 3. Per-agent concurrency control
# 4. Global defaults with per-agent overrides
#
# This example shows realistic traffic distribution matching production patterns

test_info:
  test_suite_name: "Weighted Load Distribution Test"
  description: "Distribute load across regions matching production traffic"
  version: "1.0"

agents:
  us-east:
    endpoint: "${US_EAST_ENDPOINT}"
    auth_token: "${US_EAST_TOKEN}"
  
  eu-west:
    endpoint: "${EU_WEST_ENDPOINT}"
    auth_token: "${EU_WEST_TOKEN}"
  
  asia-pacific:
    endpoint: "${ASIA_ENDPOINT}"
    auth_token: "${ASIA_TOKEN}"

workflows:
  distributed_load_test:
    # Global defaults
    iterations: 1000         # Total iterations across all agents
    concurrency: 500         # Total concurrent threads (distributed by weight)
    ramp_up: 60              # Default ramp-up time (can be overridden per agent)
    duration: 300            # Default duration (can be overridden per agent)
    
    steps:
      # Example 1: Weighted distribution with global concurrency
      - name: api_load_weighted
        action: api_call
        agent:
          us-east:
            weight: 60       # 60% of load = 600 iterations, 300 concurrent
          eu-west:
            weight: 30       # 30% of load = 300 iterations, 150 concurrent
          asia-pacific:
            weight: 10       # 10% of load = 100 iterations, 50 concurrent
        url: "https://api.example.com/users"
        method: GET
      
      # Example 2: Per-agent concurrency override
      - name: k6_load_custom_concurrency
        action: k6_test
        agent:
          us-east:
            weight: 50
            concurrency: 200  # Override: 200 concurrent (not 250)
            ramp_up: 30       # Override: 30s ramp-up
          eu-west:
            weight: 50
            concurrency: 100  # Override: 100 concurrent (not 250)
            ramp_up: 60       # Override: 60s ramp-up (slower)
        k6_config:
          scenarios:
            - name: "Load Test"
              url: "https://api.example.com/posts"
          options:
            duration: "5m"
      
      # Example 3: Equal distribution (no weights specified)
      - name: api_equal_distribution
        action: api_call
        agent:
          us-east: {}        # Equal weight (33.3%)
          eu-west: {}        # Equal weight (33.3%)
          asia-pacific: {}   # Equal weight (33.3%)
        url: "https://api.example.com/health"
      
      # Example 4: Single agent (backward compatible)
      - name: api_single_agent
        action: api_call
        agent: us-east       # Simple string - no distribution
        url: "https://api.example.com/status"

reporting:
  output_dir: "performance_results/weighted_distribution"
  formats: ["html", "json"]

# Expected Distribution for Step 1:
# ================================
# Total: 1000 iterations, 500 concurrent
#
# us-east:   600 iterations (60%), 300 concurrent (60%), 60s ramp-up
# eu-west:   300 iterations (30%), 150 concurrent (30%), 60s ramp-up
# asia:      100 iterations (10%),  50 concurrent (10%), 60s ramp-up
#
# All agents run in PARALLEL!
